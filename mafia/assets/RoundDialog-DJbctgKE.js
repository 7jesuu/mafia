import{L as cs,r as _,a as n,q as ds,O as j,P as Q,Q as g,R as t,am as vs,al as me,T as r,V as m,S as v,t as gs,$ as V,a1 as f,U as fs,X as ms,ab as ps,aX as ys,W as O,a0 as pe,aY as hs}from"./index-mZFDmhnv.js";import{a as As,Q as p}from"./QTabPanels-DtneUSqx.js";import{P as l,E as A,U as Ss,s as _s,_ as Rs}from"./_plugin-vue_export-helper-VXAAOWQH.js";import{u as ks}from"./vue-i18n-BYz-iA8F.js";import{u as ye}from"./use-dialog-plugin-component-CnvAtoGJ.js";import{C as bs,i as Is,S as Bs,j as Ds,I as he,T as Cs,P as Js}from"./Player.Utilities-BIboltz3.js";import{_ as y}from"./ParticipantList.vue_vue_type_script_setup_true_lang-B1jpeg3E.js";import"./QList-BC2pjQWj.js";import"./PlayerRoleIcon-ApZzWwII.js";const qs={class:"col"},Ps={class:"text-subtitle1"},Gs={class:"col-auto"},ws={class:"col-auto text-caption q-pa-sm"},xs={class:"col fit"},js={class:"col-auto text-caption q-pa-sm"},Ls={class:"col fit"},Ts={class:"col-auto text-caption q-pa-sm"},Ms={class:"col fit"},Hs={class:"col-auto text-caption q-pa-sm"},Qs={class:"col fit"},Vs={class:"col-auto text-caption q-pa-sm"},Ns={class:"col fit"},Fs={class:"col-auto text-caption q-pa-sm"},Us={class:"col fit"},Es={class:"col-auto text-caption q-pa-sm"},Os={class:"col fit"},Xs={class:"col-auto text-caption q-pa-sm"},$s={class:"col fit"},zs={class:"col-auto text-caption q-pa-sm"},Ks={class:"col fit"},Ws={class:"col-auto text-caption q-pa-sm"},Ys={class:"col fit"},Zs={class:"col-auto text-caption q-pa-sm"},et={class:"col fit"},st={class:"col-auto text-caption q-pa-sm"},tt={class:"col fit"},at={class:"col-auto text-caption q-pa-sm"},nt={class:"col fit"},it={class:"col-auto text-caption q-pa-sm"},lt={class:"col fit"},rt={class:"col-auto text-caption q-pa-sm"},ut={class:"col fit"},ot={class:"col-auto text-caption q-pa-sm"},ct={class:"col fit"},dt={class:"col-auto text-caption q-pa-sm"},vt={class:"col fit"},gt={class:"col-auto text-caption q-pa-sm"},ft={class:"col-auto"},mt=cs({__name:"RoundDialog",props:{participants:{type:Array,required:!0},unsetRoles:{type:Array,required:!1,default:()=>[]}},emits:[...ye.emits],setup(Ae){const R=Ae,{dialogRef:Se,onDialogOK:_e,onDialogHide:Re}=ye(),{t:d}=ks({}),c=_([]),X=_([]),i=_("assignBodyguards"),C=_(void 0),J=_(void 0),L=_(void 0),q=_(void 0),P=_(void 0),G=_(void 0),w=_(void 0),x=_(void 0),B=_([]),$=n(()=>R.unsetRoles.includes(l.Bodyguard)),z=n(()=>R.unsetRoles.includes(l.Doctor)),K=n(()=>R.unsetRoles.includes(l.Detective)),W=n(()=>R.unsetRoles.includes(l.Journalist)),Y=n(()=>R.unsetRoles.includes(l.Judge)),Z=n(()=>R.unsetRoles.includes(l.Admirer)),ee=n(()=>R.unsetRoles.includes(l.Avenger)),se=n(()=>R.unsetRoles.includes(l.Luckling)),ke=n(()=>c.value.filter(e=>e.Role!=l.Admirer)),te=n(()=>c.value.filter(e=>e.Role!=l.Judge)),T=n(()=>c.value.filter(e=>bs.includes(e.Role))),N=n(()=>c.value.filter(e=>e.Role==l.Civilian)),be=n(()=>c.value.filter(e=>e.Role!=l.Bodyguard)),Ie=n(()=>c.value.filter(e=>e.Role==l.Admirer&&!k(e))),Be=n(()=>c.value.filter(e=>e.Role==l.Bodyguard&&!k(e))),De=n(()=>c.value.filter(e=>e.Role==l.Detective&&!k(e))),Ce=n(()=>c.value.filter(e=>e.Role==l.Doctor&&!k(e))),Je=n(()=>c.value.filter(e=>e.Role==l.Journalist&&!k(e))),qe=n(()=>c.value.filter(e=>e.Role==l.Judge&&!k(e))),ae=n(()=>c.value.filter(e=>e.Role==l.Mafia&&!k(e))),ne=n(()=>c.value.filter(e=>e.Role==l.Murderer&&!k(e))),ie=n(()=>c.value.filter(e=>e.Role==l.Psycho&&!k(e))),Pe=n(()=>{let e=c.value;return ae.value.length<2&&(e=e.filter(s=>s.Role!==l.Mafia)),e}),Ge=n(()=>{let e=c.value;return ne.value.length<2&&(e=e.filter(s=>s.Role!==l.Murderer)),e}),we=n(()=>{let e=c.value;return ie.value.length<2&&(e=e.filter(s=>s.Role!==l.Psycho)),e}),xe=n(()=>c.value),je=n(()=>ne.value),Le=n(()=>ie.value),le=n(()=>c.value.filter(e=>e.Role!=l.Detective)),re=n(()=>Ie.value.length>0),Te=n(()=>Be.value.length>0),ue=n(()=>De.value.length>0),oe=n(()=>Ce.value.length>0),ce=n(()=>Je.value.length>0),de=n(()=>qe.value.length>0),M=n(()=>ae.value.length>0),ve=n(()=>je.value.length>0),ge=n(()=>Le.value.length>0),Me=n(()=>c.value.filter(e=>e.Status!=A.None)),He=n(()=>i.value=="journalists"),F=n(()=>{if(i.value=="mafia")return!1;switch(i.value){case"murderers":return M.value}return!0}),Qe=n(()=>i.value=="journalists"&&B.value.length>1),Ve=n(()=>i.value=="summary"),H=n(()=>B.value.length>1),U=n(()=>{if(!H.value)return!1;const e=B.value.map(s=>s.Role);return e.every(s=>s==e[0])}),Ne=n(()=>H.value?U.value?d("Game.JournalistInvestigationSuccess"):d("Game.JournalistInvestigationFailure"):d("Game.JournalistInvestigationNotEnoughPlayers")),{ButtonStyle:fe}=Ss();function o(e){switch(e){case"assignBodyguards":$.value&&(i.value="assignBodyguards",L.value=void 0);return;case"bodyguards":if(!Te.value){o("assignBodyguards");return}i.value="bodyguards";return;case"mafia":if(!M.value){o("bodyguards");return}i.value="mafia";return;case"murderers":if(!ve.value){o("mafia");return}i.value="murderers";return;case"psychos":if(!ge.value){o("murderers");return}i.value="psychos";return;case"assignDoctors":if(!z.value){o("psychos");return}i.value="assignDoctors",q.value=void 0;return;case"doctors":if(!oe.value){o("assignDoctors");return}i.value="doctors";return;case"assignDetectives":if(!K.value){o("doctors");return}i.value="assignDetectives",P.value=void 0;return;case"detectives":if(!ue.value){o("assignDoctors");return}i.value="detectives";return;case"assignJournalists":if(!W.value){o("detectives");return}i.value="assignJournalists",G.value=void 0;return;case"journalists":if(!ce.value){o("assignJournalists");return}i.value="journalists";return;case"assignJudges":if(!Y.value){o("journalists");return}i.value="assignJudges",w.value=void 0;return;case"judges":if(!de.value){o("assignJudges");return}i.value="judges";return;case"assignAdmirers":if(!Z.value){o("judges");return}i.value="assignAdmirers",C.value=void 0;return;case"admirers":if(!re.value){o("assignAdmirers");return}i.value="admirers";return;case"assignAvengers":if(!ee.value){o("admirers");return}i.value="assignAvengers",J.value=void 0;return;case"assignLucklings":if(!se.value){o("assignAvengers");return}i.value="assignLucklings",x.value=void 0;return;case"summary":i.value="summary";return}}function u(e){switch(e){case"assignBodyguards":if(!$.value){u("bodyguards");return}return;case"bodyguards":if(!M.value){u("murderers");return}i.value="bodyguards";return;case"mafia":if(!M.value){u("murderers");return}i.value="mafia";return;case"murderers":if(!ve.value){u("psychos");return}i.value="murderers";return;case"psychos":if(!ge.value){u("assignDoctors");return}i.value="psychos";return;case"assignDoctors":if(!z.value){u("doctors");return}i.value="assignDoctors",q.value=void 0;return;case"doctors":if(!oe.value){u("assignDetectives");return}i.value="doctors";return;case"assignDetectives":if(!K.value){u("detectives");return}i.value="assignDetectives",P.value=void 0;return;case"detectives":if(!ue.value){u("assignJournalists");return}i.value="detectives";return;case"assignJournalists":if(!W.value){u("journalists");return}i.value="assignJournalists",G.value=void 0;return;case"journalists":if(!ce.value){u("assignJournalists");return}i.value="journalists",B.value=[];return;case"assignJudges":if(!Y.value){u("judges");return}i.value="assignJudges",w.value=void 0;return;case"judges":if(!de.value){u("assignJudges");return}i.value="judges";return;case"assignAdmirers":if(!Z.value){u("admirers");return}i.value="assignAdmirers",C.value=void 0;return;case"admirers":if(!re.value){u("assignAvengers");return}i.value="admirers";return;case"assignAvengers":if(!ee.value){u("assignLucklings");return}i.value="assignAvengers",J.value=void 0;return;case"assignLucklings":if(!se.value){u("summary");return}i.value="assignLucklings",x.value=void 0;return;case"summary":i.value="summary";return}}function Fe(){switch(i.value){case"bodyguards":o("assignBodyguards");return;case"mafia":o("bodyguards");return;case"murderers":o("mafia");return;case"psychos":o("murderers");return;case"assignDoctors":o("psychos");return;case"doctors":o("assignDoctors");return;case"assignDetectives":o("doctors");return;case"detectives":o("assignDetectives");return;case"assignJournalists":o("detectives");return;case"journalists":o("assignJournalists");return;case"assignJudges":o("journalists");return;case"judges":o("assignJudges");return;case"assignAdmirers":o("judges");return;case"admirers":o("assignAdmirers");return;case"assignAvengers":o("admirers");return;case"assignLucklings":o("assignAvengers");return;case"summary":o("assignLucklings");return}}function h(){switch(i.value){case"assignBodyguards":u("bodyguards");return;case"bodyguards":u("mafia");return;case"mafia":u("murderers");return;case"murderers":u("psychos");return;case"psychos":u("assignDoctors");return;case"assignDoctors":u("doctors");return;case"doctors":u("assignDetectives");return;case"assignDetectives":u("detectives");return;case"detectives":u("assignJournalists");return;case"assignJournalists":u("journalists");return;case"journalists":Ee(B.value,A.InvestigatedByJournalists),u("assignJudges");return;case"assignJudges":u("judges");return;case"judges":u("assignAdmirers");return;case"assignAdmirers":u("admirers");return;case"admirers":u("assignAvengers");return;case"assignAvengers":u("assignLucklings");return;case"assignLucklings":u("summary");return}}function Ue(e){return Js.includes(e.Status)}function k(e){return X.value.includes(e.Id)}function b(e,s){D(s),!(Ue(e)&&!Ds.includes(s))&&(e.Status=s)}function Ee(e,s){D(s);for(const a of e)a.Status=s}function D(e){const s=c.value.filter(a=>a.Status==e);for(const a of s)a.Status=A.None}function I(e,s){const a=c.value.find(S=>S.Id==e.Id);a!==void 0&&(a.Role=s)}function Oe(e){L.value={Id:e.Id,Role:l.Bodyguard},I(e,l.Bodyguard),h()}async function Xe(e){b(e,A.SavedByBodyguards),h()}function E(e,s){if(he.includes(e.Role))D(s),b(e,A.SavedByLuck);else if(e.Status==A.SavedByBodyguards){const a=c.value.find(S=>S.Role==l.Bodyguard);a!==void 0&&(D(A.SavedByBodyguards),D(s),b(a,s),b(e,A.SavedByBodyguards))}else b(e,s)}function $e(e){E(e,A.TargetedByMafia),h()}function ze(e){E(e,A.TargetedByMurderers),h()}function Ke(e){E(e,A.TargetedByPsychos),h()}function We(e){q.value={Id:e.Id,Role:l.Doctor},I(e,l.Doctor),h()}function Ye(e){c.value.find(a=>a.Id==e.Id&&a.Status==A.TargetedByMafia)!==void 0?b(e,A.SavedByDoctors):D(A.SavedByDoctors),h()}function Ze(e){P.value={Id:e.Id,Role:l.Detective},I(e,l.Detective),h()}async function es(e){b(e,A.InvestigatedByDetectives),h()}function ss(e){G.value={Id:e.Id,Role:l.Journalist},I(e,l.Journalist),h()}function ts(e){w.value={Id:e.Id,Role:l.Judge},I(e,l.Judge),h()}async function as(e){b(e,A.ArrestedByJudges),h()}function ns(e){C.value={Id:e.Id,Role:l.Admirer},I(e,l.Admirer),h()}async function is(e){b(e,A.ChosenByAdmirers),h()}function ls(e){J.value={Id:e.Id,Role:l.Avenger},I(e,l.Avenger),h()}function rs(e){x.value={Id:e.Id,Role:l.Luckling},I(e,l.Luckling),h()}function us(e){return Cs.includes(e.Status)&&!he.includes(e.Role)}function os(){const e=c.value.filter(S=>us(S)).map(S=>S.Id),s=[],a=c.value.filter(S=>Bs.includes(S.Status)).map(S=>({Id:S.Id,Status:S.Status}));C.value!==void 0&&s.push(C.value),J.value!==void 0&&s.push(J.value),L.value!==void 0&&s.push(L.value),q.value!==void 0&&s.push(q.value),P.value!==void 0&&s.push(P.value),G.value!==void 0&&s.push(G.value),w.value!==void 0&&s.push(w.value),x.value!==void 0&&s.push(x.value),_e({RemovedParticipants:e,SetRoles:s,SetStatuses:a})}return ds(()=>{c.value=R.participants.map(e=>({...e})),X.value=c.value.filter(e=>Is.includes(e.Status)).map(e=>e.Id),u("assignBodyguards")}),(e,s)=>(j(),Q(hs,{ref_key:"dialogRef",ref:Se,onHide:s[21]||(s[21]=()=>v(Re)()),persistent:""},{default:g(()=>[t(vs,{class:"q-dialog-plugin dialog-card column no-wrap","non-square":""},{default:g(()=>[t(me,{class:"col-auto row items-center justify-between"},{default:g(()=>[r("div",qs,[r("div",Ps,m(v(d)("Game.GameRound")),1)]),r("div",Gs,[gs(t(V,{icon:"s_close",round:"",flat:""},null,512),[[_s]])])]),_:1}),t(f),t(me,{class:"col grid scroll fit q-pa-none"},{default:g(()=>[t(As,{modelValue:i.value,"onUpdate:modelValue":s[17]||(s[17]=a=>i.value=a),class:"fit","keep-alive":"",animated:""},{default:g(()=>[t(p,{class:"column fit no-wrap q-pa-none",name:"assignBodyguards"},{default:g(()=>[r("div",ws,m(v(d)("Game.AssignBodyguardRoleCaption")),1),t(f),r("div",xs,[t(y,{class:"fit scroll",items:N.value,onItemClick:s[0]||(s[0]=a=>Oe(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"bodyguards"},{default:g(()=>[r("div",js,m(v(d)("Game.BodyguardProtecteeCaption")),1),t(f),r("div",Ls,[t(y,{class:"fit scroll",items:be.value,onItemClick:s[1]||(s[1]=a=>Xe(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"mafia"},{default:g(()=>[r("div",Ts,m(v(d)("Game.MafiaTargetCaption")),1),t(f),r("div",Ms,[t(y,{class:"fit scroll",items:Pe.value,onItemClick:s[2]||(s[2]=a=>$e(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"murderers"},{default:g(()=>[r("div",Hs,m(v(d)("Game.MurdererTargetCaption")),1),t(f),r("div",Qs,[t(y,{class:"fit scroll",items:Ge.value,onItemClick:s[3]||(s[3]=a=>ze(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"psychos"},{default:g(()=>[r("div",Vs,m(v(d)("Game.PsychoTargetCaption")),1),t(f),r("div",Ns,[t(y,{class:"fit scroll",items:we.value,onItemClick:s[4]||(s[4]=a=>Ke(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"assignDoctors"},{default:g(()=>[r("div",Fs,m(v(d)("Game.AssignDoctorRoleCaption")),1),t(f),r("div",Us,[t(y,{class:"fit scroll",items:T.value,onItemClick:s[5]||(s[5]=a=>We(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"doctors"},{default:g(()=>[r("div",Es,m(v(d)("Game.DoctorSaveCaption")),1),t(f),r("div",Os,[t(y,{class:"fit scroll",items:xe.value,onItemClick:s[6]||(s[6]=a=>Ye(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"assignDetectives"},{default:g(()=>[r("div",Xs,m(v(d)("Game.AssignDetectiveRoleCaption")),1),t(f),r("div",$s,[t(y,{class:"fit scroll",items:T.value,onItemClick:s[7]||(s[7]=a=>Ze(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"detectives"},{default:g(()=>[r("div",zs,m(v(d)("Game.DetectiveInvestigateCaption")),1),t(f),r("div",Ks,[t(y,{class:"fit scroll",items:le.value,onItemClick:s[8]||(s[8]=a=>es(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"assignJournalists"},{default:g(()=>[r("div",Ws,m(v(d)("Game.AssignJournalistRoleCaption")),1),t(f),r("div",Ys,[t(y,{class:"fit scroll",items:T.value,onItemClick:s[9]||(s[9]=a=>ss(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"journalists"},{default:g(()=>[r("div",Zs,m(v(d)("Game.JournalistInvestigateCaption")),1),t(f),r("div",et,[t(y,{class:"fit scroll",modelValue:B.value,"onUpdate:modelValue":s[10]||(s[10]=a=>B.value=a),items:le.value,"status-highlight":"",selection:"",clickable:""},null,8,["modelValue","items"])]),t(f),r("div",{class:fs(["col-auto text-center text-caption q-pa-sm",{"text-positive":H.value&&U.value,"text-negative":H.value&&!U.value}])},m(Ne.value),3)]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"assignJudges"},{default:g(()=>[r("div",st,m(v(d)("Game.AssignJudgeRoleCaption")),1),t(f),r("div",tt,[t(y,{class:"fit scroll",items:te.value,onItemClick:s[11]||(s[11]=a=>ts(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"judges"},{default:g(()=>[r("div",at,m(v(d)("Game.JudgeArrestCaption")),1),t(f),r("div",nt,[t(y,{class:"fit scroll",items:te.value,onItemClick:s[12]||(s[12]=a=>as(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"assignAdmirers"},{default:g(()=>[r("div",it,m(v(d)("Game.AssignAdmirerRoleCaption")),1),t(f),r("div",lt,[t(y,{class:"fit scroll",items:T.value,onItemClick:s[13]||(s[13]=a=>ns(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"admirers"},{default:g(()=>[r("div",rt,m(v(d)("Game.AdmirerAdmireCaption")),1),t(f),r("div",ut,[t(y,{class:"fit scroll",items:ke.value,onItemClick:s[14]||(s[14]=a=>is(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"assignAvengers"},{default:g(()=>[r("div",ot,m(v(d)("Game.AssignAvengerRoleCaption")),1),t(f),r("div",ct,[t(y,{class:"fit scroll",items:N.value,onItemClick:s[15]||(s[15]=a=>ls(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"assignLucklings"},{default:g(()=>[r("div",dt,m(v(d)("Game.AssignLucklingRoleCaption")),1),t(f),r("div",vt,[t(y,{class:"fit scroll",items:N.value,onItemClick:s[16]||(s[16]=a=>rs(a)),"status-highlight":"",clickable:""},null,8,["items"])])]),_:1}),t(p,{class:"column fit no-wrap q-pa-none",name:"summary"},{default:g(()=>[r("div",gt,m(v(d)("Game.RoundSummary")),1),t(f),r("div",ft,[t(y,{class:"fit scroll",items:Me.value,status:""},null,8,["items"])])]),_:1})]),_:1},8,["modelValue"])]),_:1}),F.value?(j(),ms(ps,{key:0},[t(f),t(ys,{class:"col-auto",align:"right"},{default:g(()=>[F.value?(j(),Q(V,{key:0,onClick:s[18]||(s[18]=()=>Fe()),label:v(d)("General.Back"),disable:!F.value,color:"primary",flat:"","no-caps":""},null,8,["label","disable"])):O("",!0),He.value?(j(),Q(V,pe({key:1,onClick:s[19]||(s[19]=()=>h()),label:v(d)("General.Next"),disable:!Qe.value},v(fe),{color:"primary","no-caps":""}),null,16,["label","disable"])):Ve.value?(j(),Q(V,pe({key:2,onClick:s[20]||(s[20]=()=>os()),label:v(d)("General.Proceed")},v(fe),{color:"primary","no-caps":""}),null,16,["label"])):O("",!0)]),_:1})],64)):O("",!0)]),_:1})]),_:1},512))}}),It=Rs(mt,[["__scopeId","data-v-d73a7f29"]]);export{It as default};
