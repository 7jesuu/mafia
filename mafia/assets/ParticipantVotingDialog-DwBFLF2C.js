import{L as X,r as g,a5 as j,a as f,O as v,P as k,Q as p,R as o,am as K,al as G,T as s,V as C,S as l,t as W,$ as y,a1 as I,X as L,ab as Y,a_ as z,W as w,aX as J,a0 as Z,aY as ee}from"./index-mZFDmhnv.js";import{U as te,ag as ae,s as oe,ah as se,ai as le,_ as ne}from"./_plugin-vue_export-helper-VXAAOWQH.js";import{u as ie}from"./vue-i18n-BYz-iA8F.js";import{u as S}from"./use-dialog-plugin-component-CnvAtoGJ.js";import{_ as re}from"./CountStepperInput.vue_vue_type_script_setup_true_lang-C5GDpztB.js";import{_ as ue}from"./ParticipantList.vue_vue_type_script_setup_true_lang-B1jpeg3E.js";import"./QList-BC2pjQWj.js";import"./Player.Utilities-BIboltz3.js";import"./PlayerRoleIcon-ApZzWwII.js";const ce={class:"col"},de={class:"text-subtitle1"},me={class:"col-auto"},pe={class:"column fit scroll no-wrap"},fe={class:"col fit"},ve={key:1,class:"text-caption"},_e={class:"col-auto"},Ve={class:"col-auto row items-center q-col-gutter-x-sm q-pa-sm"},ge={class:"col text-center text-caption"},Ce={class:"col text-center text-caption"},Ie={class:"col-auto"},be={class:"col-auto"},he=X({__name:"ParticipantVotingDialog",props:{participants:{type:Array,required:!0}},emits:[...S.emits],setup(D){const u=D,{dialogRef:R,onDialogOK:B,onDialogHide:Q}=S(),{t:n}=ie({});let r=[];const c=g("votes"),d=g(u.participants.map(a=>({Id:a.Id,Votes:0}))),_=g([]),b=g(!0),h=j("ParticipantListElement"),q=f(()=>i.value?u.participants.slice().sort((a,t)=>m(t.Id)-m(a.Id)):u.participants),x=f(()=>d.value.reduce((a,t)=>a+t.Votes,0)),P=f(()=>u.participants.length-x.value),T=f(()=>c.value=="summary"||d.value.some(a=>a.Votes>0)),i=f(()=>c.value=="summary"),{ButtonStyle:U,ComponentColor:E}=te();function N(){h.value!==null&&(h.value.$el.scrollTop=0)}function $(){switch(c.value){case"summary":c.value="votes";break}}function A(){switch(c.value){case"votes":c.value="summary",N(),F();break}}function m(a){const t=d.value.find(e=>e.Id==a);return t!==void 0?i.value&&b.value&&t==ae(r)?t.Votes+P.value:t.Votes:0}function F(){const a=Math.max(...d.value.map(e=>m(e.Id)));if(a<1)return;const t=d.value.filter(e=>m(e.Id)==a).map(e=>e.Id);_.value=u.participants.filter(e=>t.includes(e.Id))}function H(){B({RemovedParticipants:_.value.map(a=>a.Id)})}function O(a,t){const e=d.value.find(M=>M.Id==a.Id);let V;e!==void 0&&(V=e.Votes,e.Votes=t,e.Votes<V?r=se(r,e):r.includes(e)?r=le(r,e):r.push(e))}return(a,t)=>(v(),k(ee,{ref_key:"dialogRef",ref:R,onHide:t[4]||(t[4]=()=>l(Q)()),persistent:""},{default:p(()=>[o(K,{class:"q-dialog-plugin dialog-card column no-wrap","non-square":""},{default:p(()=>[o(G,{class:"col-auto row items-center justify-between"},{default:p(()=>[s("div",ce,[s("div",de,C(l(n)("Game.Voting")),1)]),s("div",me,[W(o(y,{icon:"s_close",round:"",flat:""},null,512),[[oe]])])]),_:1}),o(I),o(G,{class:"col grid fit q-pa-none"},{default:p(()=>[s("div",pe,[s("div",fe,[o(ue,{ref_key:"ParticipantListElement",ref:h,class:"fit scroll",modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=e=>_.value=e),items:q.value,selection:i.value,"status-highlight":""},{actions:p(({participant:e})=>[i.value?(v(),L("span",ve,C(l(n)("Game.VotesLabel",{Votes:m(e.Id)})),1)):(v(),k(re,{key:0,class:"q-px-sm","model-value":m(e.Id),minimum:0,maximum:u.participants.length,"onUpdate:modelValue":V=>O(e,V)},null,8,["model-value","maximum","onUpdate:modelValue"]))]),_:1},8,["modelValue","items","selection"])]),s("div",_e,[o(I)]),s("div",Ve,[s("div",ge,C(l(n)("Game.TotalVoteCountLabel",{Count:x.value})),1),s("div",Ce,C(l(n)("Game.RemainingVoteCountLabel",{Count:P.value})),1)]),i.value?w("",!0):(v(),L(Y,{key:0},[s("div",Ie,[o(I)]),s("div",be,[o(z,{modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=e=>b.value=e),label:l(n)("Game.DistributeRemainingVotes"),color:l(E)},null,8,["modelValue","label","color"])])],64))])]),_:1}),o(I),o(J,{class:"col-auto",align:"right"},{default:p(()=>[i.value?(v(),k(y,{key:0,onClick:t[2]||(t[2]=()=>$()),label:l(n)("General.Back"),color:"primary",flat:"","no-caps":""},null,8,["label"])):w("",!0),o(y,Z({onClick:t[3]||(t[3]=()=>i.value?H():A()),label:i.value?l(n)("General.Proceed"):l(n)("General.Next"),disable:!T.value},l(U),{color:"primary","no-caps":""}),null,16,["label","disable"])]),_:1})]),_:1})]),_:1},512))}}),Re=ne(he,[["__scopeId","data-v-affa8b39"]]);export{Re as default};
